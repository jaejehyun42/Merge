<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>프로필 등록</title>
</head>
<body>
  <h1>프로필 등록</h1>
  <form id="profileForm">
    <div>
      <label for="nickname">닉네임: </label>
      <input type="text" id="nickname" name="nickname" required>
    </div>
    <div>
      <label for="profile_picture">프로필 사진: </label>
      <input type="file" id="profile_picture" name="profile_picture" accept="image/*" required>
    </div>
    <button type="submit">제출</button>
  </form>
  <p id="message"></p>

  <button id="logoutButton">로그아웃</button>

  <script>
    document.getElementById('profileForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const nickname = document.getElementById('nickname').value;
      const fileInput = document.getElementById('profile_picture');
      const profilePicture = fileInput.files[0];

      if (!nickname || !profilePicture) {
        document.getElementById('message').textContent = '닉네임과 프로필 사진 모두 필요합니다.';
        return;
      }

      const formData = new FormData();
      formData.append('nickname', nickname);
      formData.append('profile_picture', profilePicture);

      try {
        const response = await fetch('/profile', {
          method: 'POST',
          body: formData
        });
        console.log("응답 상태 코드:", response.status);

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || '서버 응답 오류');
        }

    // 응답 본문이 있는지 텍스트로 먼저 확인
    const text = await response.text();
    console.log("서버 응답 본문 텍스트:", text);
  
    if (!text) {
        throw new Error('서버 응답이 비어 있습니다.');
    }

    const data = JSON.parse(text);
    console.log("서버로부터 받은 JSON:", data);
    document.getElementById('message').textContent = `프로필이 성공적으로 저장되었습니다! ID: ${data.id}`;
    } catch (error) {
        console.error(error);
        document.getElementById('message').textContent = error.message;
        }
    });

	document.getElementById('logoutButton').addEventListener('click', function() {
    window.location.href = '/logout';
  });
  </script>
</body>
</html>
